<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <link  href="./style.css" rel="stylesheet" type="text/css">
        <title>Trianglify</title>
    </head>

    <body>
        <header>
            <nav class="navbar">
                <div class="navbar__title">Trianglify</div>
                <div>by <a href="https://github.com/Suissehide">Suissehide</a></div>
            </nav>
        </header>
        <div class="container">
            <div class="content">
                <div class="sidebar">

                </div>
                <div class="preview">
                    <div class="preview__content">
                        <canvas id="canvas-preview" height="900" width="1440"></canvas>
                        <div class="preview__export">
                            <button class="preview__export-btn">
                                <i class="fas fa-export"></i>
                                EXPORT
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>

<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/trianglify/2.0.0/trianglify.min.js"></script>

<script>
    let canvasWidth = 1920; //window.innerWidth
    let canvasHeight = 1080; //window.innerHeight

    // var pattern = Trianglify({
    //     height: canvasHeight,
    //     width: canvasWidth,
    //     x_colors: ['#F3EEDB', '#99CC33', '#FCCD2D'],
    //     y_colors: ['#F8B72A', '#3D2314'],
    //     // cell_size: Math.ceil(window.innerWidth / 8),
    //     color_space: 'lab',
    //     stroke_width: 1.51,
    //     cell_size: 75,
    //     // variance: 0.75,
    //     // seed: null,
    // })

    var pattern = Trianglify({
        width: canvasWidth,
        height: canvasHeight,
        x_colors: "random",
        variance: .5,
        cell_size: 150,
        stroke_width: 1.51,
        seed: null
	});

    var preview = document.getElementById('canvas-preview')
    var patternPreview = pattern.canvas(preview);
    
    //fix anti aliasing
    var context = patternPreview.getContext("2d");
    context.save();
    context.drawImage(patternPreview, 0, 0);
    context.restore();

    $('.preview__export-btn').click(function(e) {
        e.preventDefault();

        saveCanvasToPng(patternPreview);
        // downloadPng(pattern.png());
    });

    function downloadPng(base64string) {
        const pageImage = new Image();
        pageImage.src = base64string;
        pageImage.onload = function() {
            const canvas = document.createElement('canvas');
            canvas.width = pageImage.naturalWidth;
            canvas.height= pageImage.naturalHeight;

            const ctx = canvas.getContext('2d');
            ctx.imageSmoothingEnabled = false;
            ctx.drawImage(pageImage, 0, 0);
            saveCanvasToPng(canvas);
        }
    }

    function saveCanvasToPng(canvas) {
        let fileName = "image";
        const link = document.createElement('a');
        link.download = fileName + '.png';
        canvas.toBlob(function(blob) {
            link.href = URL.createObjectURL(blob);
            link.click();
        });
    }
</script>